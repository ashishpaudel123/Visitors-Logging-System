/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/10.1.13
 * Generated at: 2025-12-08 10:20:33 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.pages;

import jakarta.servlet.*;
import jakarta.servlet.http.*;
import jakarta.servlet.jsp.*;
import com.visitor.system.dao.VisitorDAO;

public final class cleanLogs_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent,
                 org.apache.jasper.runtime.JspSourceImports,
                 org.apache.jasper.runtime.JspSourceDirectives {

  private static final jakarta.servlet.jsp.JspFactory _jspxFactory =
          jakarta.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private static final java.util.Set<java.lang.String> _jspx_imports_packages;

  private static final java.util.Set<java.lang.String> _jspx_imports_classes;

  static {
    _jspx_imports_packages = new java.util.HashSet<>();
    _jspx_imports_packages.add("jakarta.servlet");
    _jspx_imports_packages.add("jakarta.servlet.http");
    _jspx_imports_packages.add("jakarta.servlet.jsp");
    _jspx_imports_classes = new java.util.HashSet<>();
    _jspx_imports_classes.add("com.visitor.system.dao.VisitorDAO");
  }

  private volatile jakarta.el.ExpressionFactory _el_expressionfactory;
  private volatile org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public java.util.Set<java.lang.String> getPackageImports() {
    return _jspx_imports_packages;
  }

  public java.util.Set<java.lang.String> getClassImports() {
    return _jspx_imports_classes;
  }

  public boolean getErrorOnELNotFound() {
    return false;
  }

  public jakarta.el.ExpressionFactory _jsp_getExpressionFactory() {
    if (_el_expressionfactory == null) {
      synchronized (this) {
        if (_el_expressionfactory == null) {
          _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
        }
      }
    }
    return _el_expressionfactory;
  }

  public org.apache.tomcat.InstanceManager _jsp_getInstanceManager() {
    if (_jsp_instancemanager == null) {
      synchronized (this) {
        if (_jsp_instancemanager == null) {
          _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
        }
      }
    }
    return _jsp_instancemanager;
  }

  public void _jspInit() {
  }

  public void _jspDestroy() {
  }

  public void _jspService(final jakarta.servlet.http.HttpServletRequest request, final jakarta.servlet.http.HttpServletResponse response)
      throws java.io.IOException, jakarta.servlet.ServletException {

    if (!jakarta.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) {
      final java.lang.String _jspx_method = request.getMethod();
      if ("OPTIONS".equals(_jspx_method)) {
        response.setHeader("Allow","GET, HEAD, POST, OPTIONS");
        return;
      }
      if (!"GET".equals(_jspx_method) && !"POST".equals(_jspx_method) && !"HEAD".equals(_jspx_method)) {
        response.setHeader("Allow","GET, HEAD, POST, OPTIONS");
        response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, "JSPs only permit GET, POST or HEAD. Jasper also permits OPTIONS");
        return;
      }
    }

    final jakarta.servlet.jsp.PageContext pageContext;
    jakarta.servlet.http.HttpSession session = null;
    final jakarta.servlet.ServletContext application;
    final jakarta.servlet.ServletConfig config;
    jakarta.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    jakarta.servlet.jsp.JspWriter _jspx_out = null;
    jakarta.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write('\n');

    VisitorDAO dao = new VisitorDAO();
    int totalVisitors = dao.getTotalVisitorCount();
    
    String daysParam = request.getParameter("days");
    int days = 30; // default
    try {
        if (daysParam != null && !daysParam.isEmpty()) {
            days = Integer.parseInt(daysParam);
        }
    } catch (NumberFormatException e) {
        days = 30;
    }
    
    int oldVisitors = dao.getOldVisitorCount(days);
    
    String cleaned = request.getParameter("cleaned");
    String deletedCountParam = request.getParameter("count");

      out.write("\n");
      out.write("<!DOCTYPE html>\n");
      out.write("<html class=\"light\" lang=\"en\">\n");
      out.write("  <head>\n");
      out.write("    <meta charset=\"utf-8\" />\n");
      out.write("    <meta content=\"width=device-width, initial-scale=1.0\" name=\"viewport\" />\n");
      out.write("    <title>Clean Old Logs - Visitor Entry System</title>\n");
      out.write("    <script src=\"https://cdn.tailwindcss.com?plugins=forms,container-queries\"></script>\n");
      out.write("    <link\n");
      out.write("      href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap\"\n");
      out.write("      rel=\"stylesheet\"\n");
      out.write("    />\n");
      out.write("    <link\n");
      out.write("      href=\"https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap\"\n");
      out.write("      rel=\"stylesheet\"\n");
      out.write("    />\n");
      out.write("    <script id=\"tailwind-config\">\n");
      out.write("      tailwind.config = {\n");
      out.write("        darkMode: \"class\",\n");
      out.write("        theme: {\n");
      out.write("          extend: {\n");
      out.write("            colors: {\n");
      out.write("              primary: \"#137fec\",\n");
      out.write("              \"background-light\": \"#f6f7f8\",\n");
      out.write("              \"background-dark\": \"#101922\",\n");
      out.write("            },\n");
      out.write("            fontFamily: {\n");
      out.write("              display: [\"Inter\", \"sans-serif\"],\n");
      out.write("            },\n");
      out.write("            borderRadius: {\n");
      out.write("              DEFAULT: \"0.25rem\",\n");
      out.write("              lg: \"0.5rem\",\n");
      out.write("              xl: \"0.75rem\",\n");
      out.write("              full: \"9999px\",\n");
      out.write("            },\n");
      out.write("          },\n");
      out.write("        },\n");
      out.write("      };\n");
      out.write("    </script>\n");
      out.write("    <style>\n");
      out.write("      .material-symbols-outlined {\n");
      out.write("        font-variation-settings: \"FILL\" 0, \"wght\" 400, \"GRAD\" 0, \"opsz\" 24;\n");
      out.write("      }\n");
      out.write("    </style>\n");
      out.write("  </head>\n");
      out.write("  <body class=\"font-display\">\n");
      out.write("    <div\n");
      out.write("      class=\"relative flex h-auto min-h-screen w-full flex-col bg-background-light dark:bg-background-dark group/design-root overflow-x-hidden\"\n");
      out.write("    >\n");
      out.write("      <div class=\"layout-container flex h-full grow flex-col\">\n");
      out.write("        <div\n");
      out.write("          class=\"flex flex-1 justify-center p-4 sm:p-6 md:p-8 lg:py-12 lg:px-40\"\n");
      out.write("        >\n");
      out.write("          <div\n");
      out.write("            class=\"layout-content-container flex flex-col max-w-[960px] flex-1 gap-8\"\n");
      out.write("          >\n");
      out.write("            <!-- Header -->\n");
      out.write("            <div class=\"flex flex-wrap justify-between items-start gap-4\">\n");
      out.write("              <div class=\"flex flex-col gap-2\">\n");
      out.write("                <p\n");
      out.write("                  class=\"text-slate-900 dark:text-slate-50 text-3xl sm:text-4xl font-black leading-tight tracking-[-0.033em]\"\n");
      out.write("                >\n");
      out.write("                  Clean Old Logs\n");
      out.write("                </p>\n");
      out.write("                <p\n");
      out.write("                  class=\"text-slate-500 dark:text-slate-400 text-base font-normal leading-normal\"\n");
      out.write("                >\n");
      out.write("                  Remove visitor entries older than a specific number of days.\n");
      out.write("                </p>\n");
      out.write("              </div>\n");
      out.write("              <a\n");
      out.write("                href=\"dashboard.jsp\"\n");
      out.write("                class=\"flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800\"\n");
      out.write("              >\n");
      out.write("                <span class=\"material-symbols-outlined text-xl\"\n");
      out.write("                  >arrow_back</span\n");
      out.write("                >\n");
      out.write("                <span>Back to Dashboard</span>\n");
      out.write("              </a>\n");
      out.write("            </div>\n");
      out.write("\n");
      out.write("            <!-- Stats Cards -->\n");
      out.write("            <div class=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n");
      out.write("              <div\n");
      out.write("                class=\"flex flex-1 flex-col gap-4 rounded-xl p-6 border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900/50\"\n");
      out.write("              >\n");
      out.write("                <div class=\"flex items-center gap-3\">\n");
      out.write("                  <span\n");
      out.write("                    class=\"material-symbols-outlined text-slate-500 dark:text-slate-400\"\n");
      out.write("                    >groups</span\n");
      out.write("                  >\n");
      out.write("                  <p\n");
      out.write("                    class=\"text-slate-700 dark:text-slate-300 text-base font-medium leading-normal\"\n");
      out.write("                  >\n");
      out.write("                    Total visitors in the system\n");
      out.write("                  </p>\n");
      out.write("                </div>\n");
      out.write("                <p\n");
      out.write("                  class=\"text-slate-900 dark:text-slate-50 tracking-tight text-3xl font-bold leading-tight\"\n");
      out.write("                >\n");
      out.write("                  ");
      out.print( totalVisitors );
      out.write("\n");
      out.write("                </p>\n");
      out.write("              </div>\n");
      out.write("              <div\n");
      out.write("                class=\"flex flex-1 flex-col gap-4 rounded-xl p-6 border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900/50\"\n");
      out.write("              >\n");
      out.write("                <div class=\"flex items-center gap-3\">\n");
      out.write("                  <span\n");
      out.write("                    class=\"material-symbols-outlined text-slate-500 dark:text-slate-400\"\n");
      out.write("                    >calendar_clock</span\n");
      out.write("                  >\n");
      out.write("                  <p\n");
      out.write("                    class=\"text-slate-700 dark:text-slate-300 text-base font-medium leading-normal\"\n");
      out.write("                  >\n");
      out.write("                    Visitors older than\n");
      out.write("                    <span id=\"display-days\">");
      out.print( days );
      out.write("</span> days\n");
      out.write("                  </p>\n");
      out.write("                </div>\n");
      out.write("                <p\n");
      out.write("                  class=\"text-slate-900 dark:text-slate-50 tracking-tight text-3xl font-bold leading-tight\"\n");
      out.write("                  id=\"old-visitors-count\"\n");
      out.write("                >\n");
      out.write("                  ");
      out.print( oldVisitors );
      out.write("\n");
      out.write("                </p>\n");
      out.write("              </div>\n");
      out.write("            </div>\n");
      out.write("\n");
      out.write("            <div\n");
      out.write("              class=\"border-t border-slate-200 dark:border-slate-800 my-4\"\n");
      out.write("            ></div>\n");
      out.write("\n");
      out.write("            <!-- Clean Logs Form -->\n");
      out.write("            <div class=\"flex flex-col items-start gap-6\">\n");
      out.write("              <div class=\"flex flex-col gap-3 w-full max-w-sm\">\n");
      out.write("                <label\n");
      out.write("                  class=\"text-slate-700 dark:text-slate-300 text-base font-medium\"\n");
      out.write("                  for=\"days-input\"\n");
      out.write("                  >Enter number of days:</label\n");
      out.write("                >\n");
      out.write("                <input\n");
      out.write("                  class=\"w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900/50 px-4 py-2 text-slate-900 dark:text-slate-50 shadow-sm focus:border-primary focus:ring-primary\"\n");
      out.write("                  id=\"days-input\"\n");
      out.write("                  type=\"number\"\n");
      out.write("                  min=\"1\"\n");
      out.write("                  value=\"");
      out.print( days );
      out.write("\"\n");
      out.write("                  onchange=\"updateOldCount(this.value)\"\n");
      out.write("                />\n");
      out.write("              </div>\n");
      out.write("              <p class=\"text-slate-500 dark:text-slate-400 text-sm\">\n");
      out.write("                Clicking the button below will open a confirmation dialog to\n");
      out.write("                permanently remove old visitor logs from the system based on the\n");
      out.write("                number of days specified.\n");
      out.write("              </p>\n");
      out.write("              <button\n");
      out.write("                onclick=\"showConfirmDialog()\"\n");
      out.write("                class=\"flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center gap-2 overflow-hidden rounded-lg h-12 px-6 bg-primary text-white text-base font-bold leading-normal tracking-[0.015em] shadow-sm hover:bg-primary/90 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary\"\n");
      out.write("              >\n");
      out.write("                <span class=\"material-symbols-outlined\">delete_sweep</span>\n");
      out.write("                <span class=\"truncate\">Clean Logs</span>\n");
      out.write("              </button>\n");
      out.write("            </div>\n");
      out.write("          </div>\n");
      out.write("        </div>\n");
      out.write("      </div>\n");
      out.write("    </div>\n");
      out.write("\n");
      out.write("    <!-- Confirmation Dialog (Hidden by default) -->\n");
      out.write("    <div\n");
      out.write("      id=\"confirm-dialog\"\n");
      out.write("      class=\"fixed inset-0 z-50 hidden items-center justify-center bg-black/60 p-4\"\n");
      out.write("    >\n");
      out.write("      <div\n");
      out.write("        class=\"flex w-full max-w-md flex-col gap-6 rounded-xl bg-white dark:bg-slate-900 p-6 shadow-2xl\"\n");
      out.write("      >\n");
      out.write("        <div class=\"flex flex-col gap-3\">\n");
      out.write("          <h3 class=\"text-xl font-bold text-slate-900 dark:text-slate-50\">\n");
      out.write("            Confirm Deletion\n");
      out.write("          </h3>\n");
      out.write("          <p class=\"text-slate-500 dark:text-slate-400\">\n");
      out.write("            Are you sure you want to permanently delete visitor logs older than\n");
      out.write("            <span\n");
      out.write("              class=\"font-bold text-slate-700 dark:text-slate-300\"\n");
      out.write("              id=\"confirm-days\"\n");
      out.write("              >");
      out.print( days );
      out.write("</span\n");
      out.write("            >\n");
      out.write("            days? This action cannot be undone.\n");
      out.write("          </p>\n");
      out.write("        </div>\n");
      out.write("        <div\n");
      out.write("          class=\"flex w-full flex-col-reverse sm:flex-row sm:justify-end gap-3\"\n");
      out.write("        >\n");
      out.write("          <button\n");
      out.write("            onclick=\"hideConfirmDialog()\"\n");
      out.write("            class=\"flex h-10 items-center justify-center rounded-lg border border-slate-300 dark:border-slate-700 bg-transparent px-4 text-sm font-semibold text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800\"\n");
      out.write("          >\n");
      out.write("            Cancel\n");
      out.write("          </button>\n");
      out.write("          <button\n");
      out.write("            onclick=\"submitCleanForm()\"\n");
      out.write("            class=\"flex h-10 items-center justify-center rounded-lg bg-red-600 px-4 text-sm font-semibold text-white shadow-sm hover:bg-red-500\"\n");
      out.write("          >\n");
      out.write("            Confirm &amp; Clean\n");
      out.write("          </button>\n");
      out.write("        </div>\n");
      out.write("      </div>\n");
      out.write("    </div>\n");
      out.write("\n");
      out.write("    <!-- Success Toast (Hidden by default) -->\n");
      out.write("    ");
 if ("1".equals(cleaned)) { 
      out.write("\n");
      out.write("    <div\n");
      out.write("      id=\"success-toast\"\n");
      out.write("      class=\"fixed bottom-5 right-5 z-50 flex items-center gap-3 rounded-lg bg-slate-900 dark:bg-slate-50 p-4 text-white dark:text-slate-900 shadow-lg\"\n");
      out.write("    >\n");
      out.write("      <span class=\"material-symbols-outlined text-green-400 dark:text-green-500\"\n");
      out.write("        >check_circle</span\n");
      out.write("      >\n");
      out.write("      <p class=\"text-sm font-medium\">\n");
      out.write("        Old logs older than\n");
      out.write("        <span class=\"font-semibold\">");
      out.print( daysParam );
      out.write("</span> days cleaned\n");
      out.write("        successfully! (");
      out.print( deletedCountParam );
      out.write(" records deleted)\n");
      out.write("      </p>\n");
      out.write("    </div>\n");
      out.write("    <script>\n");
      out.write("      setTimeout(() => {\n");
      out.write("        const toast = document.getElementById(\"success-toast\");\n");
      out.write("        if (toast) {\n");
      out.write("          toast.style.opacity = \"0\";\n");
      out.write("          toast.style.transition = \"opacity 0.5s\";\n");
      out.write("          setTimeout(() => toast.remove(), 500);\n");
      out.write("        }\n");
      out.write("      }, 5000);\n");
      out.write("    </script>\n");
      out.write("    ");
 } 
      out.write("\n");
      out.write("\n");
      out.write("    <!-- Hidden Form for Submission -->\n");
      out.write("    <form\n");
      out.write("      id=\"clean-form\"\n");
      out.write("      method=\"POST\"\n");
      out.write("      action=\"../cleanLogs\"\n");
      out.write("      style=\"display: none\"\n");
      out.write("    >\n");
      out.write("      <input type=\"hidden\" name=\"days\" id=\"form-days\" value=\"");
      out.print( days );
      out.write("\" />\n");
      out.write("    </form>\n");
      out.write("\n");
      out.write("    <script>\n");
      out.write("      function showConfirmDialog() {\n");
      out.write("        const days = document.getElementById(\"days-input\").value;\n");
      out.write("        document.getElementById(\"confirm-days\").textContent = days;\n");
      out.write("        document.getElementById(\"form-days\").value = days;\n");
      out.write("        document.getElementById(\"confirm-dialog\").classList.remove(\"hidden\");\n");
      out.write("        document.getElementById(\"confirm-dialog\").classList.add(\"flex\");\n");
      out.write("      }\n");
      out.write("\n");
      out.write("      function hideConfirmDialog() {\n");
      out.write("        document.getElementById(\"confirm-dialog\").classList.remove(\"flex\");\n");
      out.write("        document.getElementById(\"confirm-dialog\").classList.add(\"hidden\");\n");
      out.write("      }\n");
      out.write("\n");
      out.write("      function submitCleanForm() {\n");
      out.write("        document.getElementById(\"clean-form\").submit();\n");
      out.write("      }\n");
      out.write("\n");
      out.write("      async function updateOldCount(days) {\n");
      out.write("        document.getElementById(\"display-days\").textContent = days;\n");
      out.write("        document.getElementById(\"form-days\").value = days;\n");
      out.write("        // Reload page with new days parameter to update count\n");
      out.write("        window.location.href = \"cleanLogs.jsp?days=\" + days;\n");
      out.write("      }\n");
      out.write("    </script>\n");
      out.write("  </body>\n");
      out.write("</html>\n");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof jakarta.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try {
            if (response.isCommitted()) {
              out.flush();
            } else {
              out.clearBuffer();
            }
          } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
